FROM node:16-alpine as builder

WORKDIR /home/node/build

# ØªØ«Ø¨ÙŠØª Ø§Ù„Ø­Ø²Ù…
COPY package.json .
COPY package-lock.json .
RUN npm install --include=dev --legacy-peer-deps

# Ø§Ù„Ø¨Ù†Ø§Ø¡
COPY . .
RUN npm run build

# Ù…Ø±Ø­Ù„Ø© Nginx
FROM nginx:alpine

# ØªÙ†Ø¸ÙŠÙ ÙˆØ¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª
RUN rm -r /usr/share/nginx/html/*
RUN mkdir -p /usr/share/nginx/html/manage

# ğŸ‘‡ ØªØ¹Ø¯ÙŠÙ„ Ù„Ø¶Ù…Ø§Ù† Ù†Ø³Ø® Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„ØµØ­ÙŠØ­ ğŸ‘‡
# ÙÙŠ Ù…Ø¹Ø¸Ù… Ù…Ø´Ø§Ø±ÙŠØ¹ ReactØŒ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù†Ø§ØªØ¬ Ù‡Ùˆ build
# Ù†Ù‚ÙˆÙ… Ø¨Ù†Ø³Ø® Ù…Ø­ØªÙˆÙŠØ§ØªÙ‡ Ø¥Ù„Ù‰ Ù…Ø¬Ù„Ø¯ manage
COPY --from=builder /home/node/build/build /usr/share/nginx/html/manage

# Ù†Ø³Ø® Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Nginx Ø§Ù„Ù…Ø­Ø¯Ø«Ø© (Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ proxy_pass)
COPY ./nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
